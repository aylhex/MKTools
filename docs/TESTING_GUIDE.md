# 应用脱壳模块测试指南

## 快速测试清单

### ✅ 基础功能测试

#### 1. 环境检测
```bash
# 运行环境检测脚本
bash scripts/test-frida.sh

# 预期输出：
# ✓ Frida 已安装
# ✓ Python3 已安装
# ✓ Frida 资源文件存在
# ✓ 检测到设备
```

#### 2. Android 设备测试

**前置条件：**
- [ ] Android 设备已连接
- [ ] ADB 可用 (`adb devices`)
- [ ] 设备已安装第三方应用

**测试步骤：**
1. 启动应用：`npm run dev`
2. 选择 Android 设备
3. 进入"应用脱壳"标签
4. 等待 5-10 秒

**预期结果：**
- [ ] Frida 状态显示"已就绪"（绿色）
- [ ] 应用列表正确加载
- [ ] 应用名称显示正确（不是包名）
- [ ] 大部分应用显示图标
- [ ] 搜索功能正常

**检查点：**
```
✓ 应用名称：应该显示 "微信" 而不是 "com.tencent.mm"
✓ 应用图标：应该显示彩色图标，不是灰色方块
✓ 应用数量：应该显示所有第三方应用
```

#### 3. iOS 设备测试

**前置条件：**
- [ ] iOS 设备已越狱
- [ ] SSH 可用 (`ssh -p 2222 root@localhost`)
- [ ] iproxy 运行中
- [ ] 设备已安装第三方应用

**测试步骤：**
1. 启动应用：`npm run dev`
2. 选择 iOS 设备
3. 进入"应用脱壳"标签
4. 等待 10-15 秒（首次部署 Frida 需要更长时间）

**预期结果：**
- [ ] Frida 状态显示"已就绪"（绿色）
- [ ] 应用列表正确加载
- [ ] 应用名称显示正确
- [ ] 应用图标显示（部分应用可能无图标）
- [ ] 搜索功能正常

### ✅ 脱壳功能测试

#### Android 应用脱壳

**测试应用：** 选择一个简单的第三方应用

**步骤：**
1. 在应用列表中点击目标应用
2. 查看应用信息对话框
3. 确认 Frida 状态为"已就绪"
4. 点击"开始脱壳"
5. 观察右侧控制台日志

**预期日志：**
```
[Init] 开始脱壳应用: com.example.app
[Step 1/5] 检查 Frida 工具...
[✓] Frida 工具已安装
[Step 2/5] 检查并部署 Frida Server...
[✓] Frida Server 已就绪
[Step 3/5] 准备输出目录...
[✓] 输出目录: /tmp/mktools_decrypt
[Step 4/5] 开始脱壳进程...
[Android] 连接到应用进程...
...
[✓] Android 应用脱壳完成
[✓] 输出文件: /tmp/mktools_decrypt/...
```

**验证输出：**
```bash
ls -lh /tmp/mktools_decrypt/
# 应该看到生成的 APK 文件
```

#### iOS 应用脱壳

**测试应用：** 选择一个简单的第三方应用

**步骤：**
1. 在应用列表中点击目标应用
2. 查看应用信息对话框
3. 确认 Frida 状态为"已就绪"
4. 点击"开始脱壳"
5. 观察右侧控制台日志

**预期日志：**
```
[Init] 开始脱壳应用: com.example.app
[Step 1/5] 检查 Frida 工具...
[✓] Frida 工具已安装
[Step 2/5] 检查并部署 Frida Server...
[iOS] 使用 frida-ios-dump 进行脱壳...
...
[✓] iOS 应用脱壳完成
[✓] 输出文件: /tmp/mktools_decrypt/...
```

### ✅ 错误处理测试

#### 1. Frida 未安装

**模拟：**
```bash
# 临时重命名 frida
mv $(which frida) $(which frida).bak
```

**预期：**
- Frida 状态显示"未就绪"（黄色）
- 应用列表使用备用方法加载
- 显示包名而不是应用名称
- 脱壳按钮禁用

**恢复：**
```bash
mv $(which frida).bak $(which frida)
```

#### 2. 设备未连接

**测试：**
- 断开设备连接
- 刷新应用

**预期：**
- 应用列表为空
- Frida 状态显示"状态未知"（灰色）
- 显示"未检测到设备"提示

#### 3. Frida Server 启动失败

**可能原因：**
- 设备无 root 权限
- 端口被占用
- 架构不匹配

**预期：**
- Frida 状态显示"未就绪"（黄色）
- 控制台显示详细错误信息
- 提供故障排除建议

### ✅ 性能测试

#### 应用列表加载时间

**测试设备：** 安装 50+ 应用的设备

**测量：**
- 从选择设备到应用列表显示的时间
- Frida 方法：应该在 10-15 秒内完成
- 备用方法：应该在 5-10 秒内完成

**优化目标：**
- 初始列表：< 5 秒
- 图标加载：< 15 秒
- 总体体验：流畅，无卡顿

#### 内存使用

**监控：**
```bash
# 启动应用前
ps aux | grep electron

# 加载应用列表后
ps aux | grep electron

# 预期：内存增长 < 200MB
```

### ✅ UI/UX 测试

#### 1. 状态指示器

**测试场景：**
- [ ] 未连接设备：灰色 + "状态未知"
- [ ] 正在检查：蓝色动画 + "正在检查..."
- [ ] 连接成功：绿色脉冲 + "Frida 已就绪"
- [ ] 连接失败：黄色 + "Frida 未就绪"

#### 2. 应用列表

**测试：**
- [ ] 图标显示正确
- [ ] 应用名称可读
- [ ] 包名显示在下方（小字）
- [ ] 悬停效果正常
- [ ] 点击响应迅速

#### 3. 搜索功能

**测试：**
- [ ] 按应用名称搜索
- [ ] 按包名搜索
- [ ] 实时过滤
- [ ] 清空搜索恢复列表

#### 4. 脱壳对话框

**测试：**
- [ ] 应用信息显示完整
- [ ] Frida 状态警告正确
- [ ] 按钮状态正确（启用/禁用）
- [ ] 关闭按钮正常
- [ ] ESC 键关闭

#### 5. 日志面板

**测试：**
- [ ] 自动滚动到底部
- [ ] 时间戳显示
- [ ] 日志分类清晰（颜色/图标）
- [ ] 清空按钮正常
- [ ] 可以手动滚动

### ✅ 兼容性测试

#### Android 版本

- [ ] Android 8.0 (Oreo)
- [ ] Android 9.0 (Pie)
- [ ] Android 10
- [ ] Android 11
- [ ] Android 12+

#### iOS 版本

- [ ] iOS 13
- [ ] iOS 14
- [ ] iOS 15
- [ ] iOS 16+

#### 设备架构

**Android:**
- [ ] arm (32-bit)
- [ ] arm64 (64-bit)

**iOS:**
- [ ] arm (32-bit, 旧设备)
- [ ] arm64 (64-bit)

## 故障排除测试

### 场景 1：Frida 版本不匹配

**模拟：**
```bash
# 安装不同版本的 Frida
pip install frida-tools==15.0.0
```

**预期：**
- 可能出现连接问题
- 日志显示版本信息
- 提供升级建议

### 场景 2：设备权限不足

**Android:**
- 非 root 设备
- 预期：Frida Server 无法启动

**iOS:**
- 非越狱设备
- 预期：SSH 连接失败

### 场景 3：网络问题

**测试：**
- 断开网络连接
- 尝试使用功能

**预期：**
- 本地功能正常（不依赖网络）
- 如果需要下载，显示网络错误
---
**最后更新：** 2026-02-05
